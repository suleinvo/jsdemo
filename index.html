<!DOCTYPE html>
<html>
<head>
   <title>Заголовок документа</title>
   <style>
      body {
        margin: 0px;
        padding: 0px;
      }
      #container {
        background-color: #222;
        display: inline-block;
        width: 580px;
        height: 202px;
      }
      #buttons {
        position: absolute;
        top: 5px;
        left: 10px;
      }
      #buttons > input {
        padding: 10px;
        display: block;
        margin-top: 5px;
      }
   </style>
</head>
<body>
    <div id="container"></div>
    <script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v5.0.1.min.js"></script>
    <script defer="defer">
        function getLine(param) {
            var imgMasCoord = new Array(48);
            for (var i = 0; i < 32; i++) {
                imgMasCoord[i * 4] = 204 * i;
                imgMasCoord[i * 4 + 1] = param;
                imgMasCoord[i * 4 + 2] = 173;
                imgMasCoord[i * 4 + 3] = 150;
            }
            return imgMasCoord;
        }
        var arrayCoords = getLine(0).concat(getLine(308)).concat(getLine(462)).concat(getLine(615));
        console.log(arrayCoords.length);
        var stage = new Kinetic.Stage({
            container: 'container',
            width: 1000,
            height: 1000
        });
        var layer = new Kinetic.Layer();
        var imageObj = new Image();
        imageObj.onload = function () {
            var blob = new Kinetic.Sprite({
                x: 10,
                y: 10,
                image: imageObj,
                animation: 'idle',
                animations: {
                    idle: arrayCoords
                },
                frameRate: 7,
                frameIndex: 0
            });

            blob.setScaleX(2);
            blob.setScaleY(2);

            // add the shape to the layer
            layer.add(blob);

            // add the layer to the stage
            stage.add(layer);

            // start sprite animation
            blob.start();

            var frameCount = 0;

            blob.on('frameIndexChange', function (evt) {
                if (blob.animation() === 'punch' && ++frameCount > 3) {
                    blob.animation('idle');
                    frameCount = 0;
                }
            });

            document.getElementById('punch').addEventListener('click', function () {
                blob.animation('punch');
            }, false);
        };
        imageObj.src = 'http://i58.fastpic.ru/big/2014/0305/0d/ad7b20ee342c6c2e76c64815807a2a0d.jpg';
    </script>
    <audio src="http://vk-music.ru/files/73605055/Dendy+-+Main+Menu+9999+in+1_(mp3top100.net).mp3" autoplay </audio>
</body>
</html>